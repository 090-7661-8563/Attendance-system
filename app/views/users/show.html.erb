<%# y = @date.year %>
<%# m = @date.month %>
<% provide(:title, @user.name) %>
<div class="row">

<!-- ヘッドのテーブル部分 -->    
    <table class="table table-bordered table-striped table-condensed">
        <thead>
            <tr>
                <th colspan="2">
                    <!--先月へ-->
                   　<%=  %>
                <%= link_to "◀︎" , user_path(params:{id: @user.id, first_day: @first_day.prev_month }), class: "btn btn-sm btn-primary" %>
                &emsp; <%= @first_day.year %>年<%= @first_day.month %>月  時間管理表 &emsp;
                <%= link_to "▶︎" , user_path(params:{id: @user.id, first_day: @first_day.next_month }), class: "btn btn-sm btn-primary" %>
                </th>
                <th>指定勤務時間</th>
                <th colspan="2">基本時間</th>
                <th>初日 <%= @first_day %></th> 
            </tr>
            <tr>
                <th>所属: <%= @user.department %></th>
                <th>氏名: <%= @user.name %></th>
                <th>コード</th>
                <th> 888 </th>
                <th>出勤日数 <%#= @attendances_count %></th>
                <th>締め <%= @last_day %></th>
            </tr>
        </thead>
    </table> 
    
<!-- 勤怠編集ボタン    -->  
    <%= link_to "勤怠を編集", edit_attendance_path, class: "btn btn-sm btn-primary" %>
    
<!-- 最初の一行目    -->
    <table class="table table-bordered table-striped table-condensed">
        <thead>
            <tr>
                <!--rowspan:縦結合、colspan：横結合-->
                <th rowspan="2" >日付</th>
                <th rowspan="2">曜日</th>
                <th rowspan="1" colspan="3">出社</th>
                <th rowspan="1" colspan="3">退社</th>
                <th rowspan="2">在社時間</th>
                <th rowspan="2">備考</th>
            </tr>
            <tr>
                <th>時</th>
                <th>分</th>
                <th>　　</th>
                <th>時</th>
                <th>分</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <!-- レコード表示部分 each文 -->
            <!--# 在社時間の集計、ついでに出勤日数も-->
            <% @days.each do |d| %>
            <tr>
                <!--１項：日付-->
                <td><%= d.attendance_day.to_s(:day) %></td>
                <!--２項：曜日-->
                <td><%= @week[d.attendance_day.wday] %></td>
                <!--３〜４項：出社時間表示（データが存在する場合）-->
                <td><%= d.started_time.to_s(:hour) if d.started_time.present? %></td>
                <td><%= d.started_time.to_s(:minute) if d.started_time.present? %></td>
                <!--５項：出社ボタン表示（当日かつ出社時間が存在しない場合）-->
                <td>
                  <% if d.attendance_day == Date.current && d.started_time.nil? %>
                    <%= button_to "出社",startedtime_creat_path(@user,params:{id: @user.id}),{class: "btn btn-attendance btn-default"}%>
                  <% end %>
                </td>
                <!--６〜７項：退社時間表示（データが存在する場合）-->
                <td><%= d.finished_time.to_s(:hour) if d.finished_time.present? %></td>
                <td><%= d.finished_time.to_s(:minute) if d.finished_time.present? %></td>
                <!--８項：退社ボタン表示（当日かつ出社時間あり、かつ退社時間なし）-->
                <td>
                  <% if d.attendance_day == Date.current && d.started_time.present? && d.finished_time.nil? %>
                    <%= button_to "退社",finishedtime_creat_path(@user,params:{id: @user.id}), class: "btn btn-attendance btn-default"%>
                  <% end %>
                </td>
                <!--９項：在社時間表示（出社時間と退社時間がどちらもある）-->
                <td>
                  <%#= working_hours(d.started_time,d.finished_time) if d.started_time.present? && d.finished_time.present?%>
                </td>
                <td>@</td>
            </tr>
            <% end %>
            <!-- 最後の一行 -->      
            <tr>
    　　　　　　<!-- 総合勤務時間の表示  --> 
                <td rowspan="1" colspan="2">@</td>
                <td colspan="6"></td>
                <td>在社時間の合計</td>
                <!-- 在社時間の合計の表示  -->
                <td>@</td>
            </tr>
        </tbody>
    </table>
</div>